function ngModule(e,t){try{return angular.module(e)}catch(o){return angular.module(e,t||[])}}angular.module("yatayat",["ionic","ngCordova","uiGmapgoogle-maps","yatayat.factories","yatayat.controllers"]).run(["$ionicPlatform","$rootScope","Loading","User","UiHelper","Router",function(e,t,o,r,n,i){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault(),t.$on("loading:show",function(){o.show()}),t.$on("loading:hide",function(){o.hide()}),t.$on("broadcast:message",function(e,t){n.showToast(t)}),r.checkRegistration().then(function(e){t.user=e,i.go("app.reports",!0).then(function(){n.showToast("Welcome back!")})})})}]).config(["$httpProvider",function(e){e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",e.interceptors.push(["$rootScope",function(e){return{request:function(t){return e.$broadcast("loading:show"),t},response:function(t){return e.$broadcast("loading:hide"),t}}}])}]).config(["uiGmapGoogleMapApiProvider",function(e){e.configure({key:"AIzaSyB09h4QtoxL3alFV4JDzArJYDjoltix4r0",v:"3.17"})}]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/start"),e.state("start",{url:"/start",templateUrl:"templates/start.html",controller:"StartCtrl"}).state("app",{url:"/app","abstract":!0,templateUrl:"templates/menu.html",controller:"AppCtrl"}).state("app.reports",{url:"/reports",views:{menuContent:{templateUrl:"templates/reports/index.html",controller:"ReportsCtrl"}},cache:!1}).state("app.report",{url:"/reports/:reportId",views:{menuContent:{templateUrl:"templates/reports/show.html",controller:"ReportCtrl"}}}).state("app.submit_report",{url:"/submit_report",views:{menuContent:{templateUrl:"templates/reports/submit.html",controller:"ReportSubmitCtrl"}},cache:!1}).state("app.edit_report",{url:"/edit_report/:reportId",views:{menuContent:{templateUrl:"templates/reports/edit.html",controller:"ReportEditCtrl"}},cache:!1}).state("app.profile",{url:"/profile",views:{menuContent:{templateUrl:"templates/profile.html",controller:"UserCtrl"}},cache:!1}).state("app.user_details",{url:"/user_details/:userId",views:{menuContent:{templateUrl:"templates/user_details.html",controller:"UserDetailsCtrl"}},cache:!1})}]),ngModule("yatayat.controllers").controller("AppCtrl",["$scope","$rootScope","Modal","$timeout",function(e,t,o,r){e.loginData={},o.setup(e,"templates/login.html"),e.login=function(){e.showModal()},e.closeLogin=function(){e.closeModal()},e.doLogin=function(){console.log("Doing login",e.loginData),r(function(){e.closeLogin()},1e3)}}]),ngModule("yatayat.controllers").controller("ReportCtrl",["$scope","$rootScope","$stateParams","Report","uiGmapGoogleMapApi","Router","UiHelper",function(e,t,o,r,n,i,a){e.report={},r.get(o.reportId).then(function(t){e.report=t,n.then(function(){var o={latitude:t.location.latitude,longitude:t.location.longitude};e.map={center:o,zoom:17,options:{scrollwheel:!1}},e.marker={id:t.location_id,coords:o,options:{draggable:!1}}})}),e.syncVotes=function(t){e.report.cached_votes_up=t.cached_votes_up,e.report.cached_votes_down=t.cached_votes_down,e.report.user.cached_votes_up=t.user.cached_votes_up,e.report.user.cached_votes_down=t.user.cached_votes_down},e.likeReport=function(){r.like(e.report,t.user).then(function(t){e.syncVotes(t)})},e.dislikeReport=function(){r.dislike(e.report,t.user).then(function(t){e.syncVotes(t)})},e.deleteReport=function(){a.confirm().then(function(){r.destroy(e.report.id).then(function(){i.go("app.reports")})})}}]),ngModule("yatayat.controllers").controller("ReportEditCtrl",["$scope","$stateParams","Report","Raven","Router","UiHelper",function(e,t,o,r,n,i){o.get(t.reportId).then(function(t){e.report=t,r.get("categories").then(function(t){e.categories=t,e.report.category=t.filter(function(t){return t.id===e.report.category_id})[0]})}),e.updateReport=function(){o.update(e.report).then(function(){n.go("app.reports",!1,!0).then(function(){i.showToast("Report Updated Successfully!")})},function(){i.showToast("Error Updating Report!")})}}]),ngModule("yatayat.controllers").controller("ReportSubmitCtrl",["$scope","$rootScope","Report","Router","$cordovaGeolocation","Raven","UiHelper",function(e,t,o,r,n,i,a){e.report={location:{}},e.useCurrentLocation=!0,e.toggleLocation=function(){e.useCurrentLocation=!e.useCurrentLocation},e.categories=[],i.get("categories").then(function(t){e.categories=t,e.report.category=e.categories[0]}),e.createReport=function(){o.create(e.report).then(function(){r.go("app.reports",!1,!0).then(function(){a.showToast("Report Created Successfully!")})})},e.createReportWithLocation=function(){t.$broadcast("loading:show"),n.getCurrentPosition({timeout:1e4,enableHighAccuracy:!0}).then(function(t){e.report.location.latitude=t.coords.latitude,e.report.location.longitude=t.coords.longitude,e.createReport()},function(){t.$broadcast("loading:hide"),a.showToast("Could not get location.")})},e.submitReport=function(){e.report.user_id=t.user.id,e.report.category_id=e.report.category.id,e.useCurrentLocation?e.createReportWithLocation():e.createReport()}}]),ngModule("yatayat.controllers").controller("ReportsCtrl",["$scope","$rootScope","Report","UiHelper",function(e,t,o,r){e.data={},e.getReports=function(t){o.all().then(function(o){e.reports=o,t&&e.$broadcast("scroll.refreshComplete")})},e.refresh=function(){e.getReports(!0)},e.search=function(e){var t=new RegExp(e,"i");return function(e){return e.category.name.match(t)||e.message&&e.message.match(t)||e.location.name.match(t)||e.user.username&&e.user.username.match(t)||e.created_at.match(t)}},e.clearSearch=function(){e.data.searchQuery=""},e.likeReport=function(r,n){n.preventDefault();var i=e.reports[r];o.like(i,t.user).then(function(t){i.cached_votes_up=t.cached_votes_up,i.cached_votes_down=t.cached_votes_down,e.refresh()})},e.dislikeReport=function(r,n){n.preventDefault();var i=e.reports[r];o.dislike(i,t.user).then(function(t){i.cached_votes_down=t.cached_votes_down,i.cached_votes_up=t.cached_votes_up,e.refresh()})},e.deleteReport=function(t,n){n.preventDefault(),r.confirm("Delete Report?").then(function(){var n=e.reports[t];o.destroy(n.id).then(function(){e.refresh(),r.showToast("Report Deleted Successfully!")})})},e.editReport=function(e,t){t.preventDefault()},e.getReports()}]),ngModule("yatayat.controllers").controller("StartCtrl",["$scope","$rootScope","User","Sim","Modal","Router","$ionicPopup","UiHelper",function(e,t,o,r,n,i,a,c){n.setup(e,"templates/tos.html"),e.registerWithCredentials=function(e,r){o.register(e,r).then(function(o){t.user=o,a.alert({title:"Success",template:e+" registered successfully."}).then(function(){i.go("app.reports",!0).then(function(){c.showToast("Welcome!")})})})},e.register=function(){r.getDetails().then(function(t){e.registerWithCredentials(t.simSerialNumber,t.line1Number)})}}]),ngModule("yatayat.controllers").controller("UserCtrl",["$scope","$rootScope","User","Router","UiHelper",function(e,t,o,r,n){e.updateProfile=function(){o.update(t.user).then(function(e){t.user=e,r.go("app.reports",!1,!0).then(function(){n.showToast("Profile Updated Successfully!")})},function(){n.showToast("Error Updating Profile!")})}}]),ngModule("yatayat.controllers").controller("UserDetailsCtrl",["$scope","$stateParams","User","Router","UiHelper",function(e,t,o,r,n){e.detailedUser=null,o.getDetails(t.userId).then(function(t){e.detailedUser=t}),e.updateUserRole=function(t){n.confirm("Change User Role?").then(function(){e.detailedUser.role=t,o.update(e.detailedUser).then(function(){r.go("app.reports",!1,!0)},function(){n.showToast("Something Went Wrong!")})})}}]),ngModule("yatayat.factories").factory("BaseModel",[function(){return{build:function(e){var t=Object.create(this);return angular.extend(t,e),t}}}]),ngModule("yatayat.factories").factory("Loading",["$ionicLoading",function(e){return{show:function(){e.show({template:"<i class='icon ion-loading-a'></i>"})},hide:function(){e.hide()},showWithOptions:function(t){e.show(t)}}}]).factory("UiHelper",["$cordovaToast","Loading","$ionicPopup","$q",function(e,t,o,r){return{showToast:function(o,r,n){r=r||3e3,n=n||"bottom",window.cordova?(r=r>1e3?"long":"short",e.show(message,r,n)):t.showWithOptions({template:o,noBackdrop:!0,duration:r})},confirm:function(e,t){var n=r.defer();return o.confirm({title:e||"Confirm",template:t||"Are you sure?"}).then(function(e){e?n.resolve():n.reject()}),n.promise}}}]).factory("Settings",["LocalStorage",function(e){return{all:function(){return{userLocation:this.userLocation(),pushNotification:this.pushNotification()}},set:function(t,o){e.set(t,o)},setMultiple:function(e){for(key in e)e.hasOwnProperty(key)&&this.set(key,e[key])},userRegistered:function(){return e.get("user_registered")},userLocation:function(){return e.get("user_location")},pushNotification:function(){return e.get("push_notification")}}}]).factory("LocalStorage",["$window",function(e){return{set:function(t,o){e.localStorage[t]=o},get:function(t,o){return e.localStorage[t]||o},setObject:function(t,o){e.localStorage[t]=JSON.stringify(o)},getObject:function(t){return JSON.parse(e.localStorage[t]||"{}")}}}]).factory("Router",["$q","$state","$ionicHistory",function(e,t,o){return{go:function(r,n,i){var a=e.defer();return t.go(r,{},{reload:!!i}).then(function(){n&&o.clearHistory(),a.resolve()}),a.promise}}}]).factory("Modal",["$ionicModal","$q",function(e,t){return{setup:function(o,r){var n=t.defer();return e.fromTemplateUrl(r,{scope:o}).then(function(e){o.modal=e,n.resolve()}),o.closeModal=function(){o.modal.hide()},o.showModal=function(){o.modal.show()},n.promise}}}]).factory("Validator",[function(){return{isValidPhone:function(e){var t=/^\d{10}$/;return e.match(t)}}}]).factory("ActionSheet",["$ionicActionSheet",function(e){return{show:function(){e.show({buttons:[{text:"<b>Share</b> This"},{text:"Move"}],titleText:msg,cancelText:"Back",cancel:function(){},buttonClicked:function(){return!0}})}}}]),ngModule("yatayat.factories").factory("Raven",["$http","$q","$rootScope",function(e,t,o){var r;return r="undefined"==typeof cordova?"http://localhost:3000/":"http://yatayat.herokuapp.com/",{urlFor:function(e){return r+e},get:function(o){var r=t.defer();return e({url:this.urlFor(o),method:"GET"}).then(function(e){r.resolve(e.data)},function(e){r.reject(e.data)}),r.promise},post:function(r,n){var i=t.defer();return o.user&&"blocked"===o.user.role?(i.reject(),o.$broadcast("broadcast:message","Sorry you are blocked from the system")):e({url:this.urlFor(r),method:"POST",data:$.param(n),withCredentials:!0}).then(function(e){i.resolve(e.data)},function(e){i.reject(e.data)}),i.promise}}}]),ngModule("yatayat.factories").factory("Report",["BaseModel","User","Raven","$q",function(e,t,o,r){return angular.extend(e,{all:function(){var t=r.defer(),n=[];return o.get("reports").then(function(o){angular.forEach(o,function(t){n.push(e.build(t))}),t.resolve(n)},function(){t.reject()}),t.promise},get:function(t){var n=r.defer();return o.get("reports/"+t).then(function(t){n.resolve(e.build(t))},function(e){n.reject(e)}),n.promise},create:function(e){var t=r.defer();return o.post("reports",{report:e}).then(function(e){e.id?t.resolve(e):t.reject()},function(e){t.reject(e)}),t.promise},update:function(e){var t=r.defer();return o.post("reports/update",{report:e}).then(function(){t.resolve()},function(e){t.reject(e)}),t.promise},like:function(e,t){var n=r.defer();return o.post("reports/like",{id:e.id,sim_serial_number:t.sim_serial_number}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},dislike:function(e,t){var n=r.defer();return o.post("reports/dislike",{id:e.id,sim_serial_number:t.sim_serial_number}).then(function(e){n.resolve(e)}),n.promise},destroy:function(e){var t=r.defer();return o.post("reports/destroy",{id:e}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},length:function(){return this.body.length}})}]),ngModule("yatayat.factories").factory("Sim",["$q",function(e){return{getDetails:function(){var t=e.defer();if("undefined"!=typeof cordova){var o=cordova.require("cordova/plugin/telephonenumber");o.get(function(e){t.resolve(e)})}else t.resolve({simSerialNumber:"Haude",line1Number:"9808640711"});return t.promise}}}]),ngModule("yatayat.factories").factory("User",["BaseModel","Raven","$q","Sim","LocalStorage",function(e,t,o,r,n){return{checkRegistration:function(){var e=o.defer(),i=n.getObject("user");return i.sim_serial_number?e.resolve(i):r.getDetails().then(function(o){t.get("users/"+o.simSerialNumber).then(function(t){t&&t.id?e.resolve(t):e.reject()},function(){e.reject()})}),e.promise},register:function(e,r){var n=o.defer();return this.checkRegistration().then(function(e){n.resolve(e)},function(){var o={};o.sim_serial_number=e,r&&(o.phone_number=r),t.post("users",{user:o}).then(function(e){e&&e.id?n.resolve(e):n.reject()},function(){n.reject()})}),n.promise},getDetails:function(e){var r=o.defer();return t.get("users/"+e+"/details").then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},update:function(e){var r=o.defer();return delete e.id,t.post("users/"+e.sim_serial_number,{user:e}).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},storeLocally:function(){},isAdmin:function(){return"admin"==this.role||"super_admin"==this.role},isSuperAdmin:function(){return"super_admin"==this.role},niceUsername:function(){return this.username||"Anonymous"},niceRole:function(){return"admin"==this.role?"Admin":"super_admin"==this.role?"Super Admin":"User"}}}]);