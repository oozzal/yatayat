function ngModule(t,e){try{return angular.module(t)}catch(o){return angular.module(t,e||[])}}angular.module("yatayat",["ionic","ngCordova","uiGmapgoogle-maps","yatayat.factories","yatayat.controllers"]).run(["$ionicPlatform","$rootScope","Loading","User","UiHelper","Router",function(t,e,o,r,n,i){t.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault(),e.$on("loading:show",function(){o.show()}),e.$on("loading:hide",function(){o.hide()}),r.checkRegistration().then(function(t){e.user=t,i.go("app.reports",!0).then(function(){n.showToast("Welcome back!")})})})}]).config(["$httpProvider",function(t){t.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",t.interceptors.push(["$rootScope",function(t){return{request:function(e){return t.$broadcast("loading:show"),e},response:function(e){return t.$broadcast("loading:hide"),e}}}])}]).config(["uiGmapGoogleMapApiProvider",function(t){t.configure({key:"AIzaSyB09h4QtoxL3alFV4JDzArJYDjoltix4r0",v:"3.17",libraries:"weather,geometry,visualization"})}]).config(["$stateProvider","$urlRouterProvider",function(t,e){e.otherwise("/start"),t.state("start",{url:"/start",templateUrl:"templates/start.html",controller:"StartCtrl"}).state("app",{url:"/app","abstract":!0,templateUrl:"templates/menu.html",controller:"AppCtrl"}).state("app.reports",{url:"/reports",views:{menuContent:{templateUrl:"templates/reports.html",controller:"ReportsCtrl"}},cache:!1}).state("app.report",{url:"/reports/:reportId",views:{menuContent:{templateUrl:"templates/report.html",controller:"ReportCtrl"}}}).state("app.submit",{url:"/submit",views:{menuContent:{templateUrl:"templates/submit.html",controller:"SubmitCtrl"}},cache:!1}).state("app.profile",{url:"/profile",views:{menuContent:{templateUrl:"templates/profile.html",controller:"UserCtrl"}}})}]),ngModule("yatayat.controllers").controller("AppCtrl",["$scope","$rootScope","Modal","$timeout",function(t,e,o,r){t.loginData={},o.setup(t,"templates/login.html"),t.login=function(){t.showModal()},t.closeLogin=function(){t.closeModal()},t.doLogin=function(){console.log("Doing login",t.loginData),r(function(){t.closeLogin()},1e3)}}]),ngModule("yatayat.controllers").controller("ReportCtrl",["$scope","$rootScope","$stateParams","Report","uiGmapGoogleMapApi",function(t,e,o,r,n){t.report={},r.get(o.reportId).then(function(e){t.report=e,n.then(function(){var o={latitude:e.location.latitude,longitude:e.location.longitude};t.map={center:o,zoom:17,options:{scrollwheel:!1}},t.marker={id:e.location_id,coords:o,options:{draggable:!1}}})})}]),ngModule("yatayat.controllers").controller("ReportsCtrl",["$scope","$rootScope","Report",function(t,e,o){t.getReports=function(e){o.all().then(function(o){t.reports=o,e&&t.$broadcast("scroll.refreshComplete")})},t.refresh=function(){t.getReports(!0)},t.likeReport=function(r,n){n.preventDefault();var i=t.reports[r];o.like(i,e.user).then(function(e){i.cached_votes_up=e.cached_votes_up,i.cached_votes_down=e.cached_votes_down,t.refresh()})},t.dislikeReport=function(r,n){n.preventDefault();var i=t.reports[r];o.dislike(i,e.user).then(function(e){i.cached_votes_down=e.cached_votes_down,i.cached_votes_up=e.cached_votes_up,t.refresh()})},t.editReport=function(t,e){e.preventDefault()},t.getReports()}]),ngModule("yatayat.controllers").controller("StartCtrl",["$scope","$rootScope","User","Sim","Modal","Router","$ionicPopup","UiHelper",function(t,e,o,r,n,i,a,c){n.setup(t,"templates/tos.html"),t.registerWithCredentials=function(t,r){o.register(t,r).then(function(o){e.user=o,a.alert({title:"Success",template:t+" registered successfully."}).then(function(){i.go("app.reports",!0).then(function(){c.showToast("Welcome!")})})})},t.register=function(){r.getDetails().then(function(e){t.registerWithCredentials(e.simSerialNumber,e.line1Number)})}}]),ngModule("yatayat.controllers").controller("SubmitCtrl",["$scope","$rootScope","Report","Router","$cordovaGeolocation","Raven","UiHelper",function(t,e,o,r,n,i,a){t.report={location:{}},t.useCurrentLocation=!0,t.toggleLocation=function(){t.useCurrentLocation=!t.useCurrentLocation},t.categories=[],i.get("categories").then(function(e){t.categories=e,t.report.category=t.categories[0]}),t.createReport=function(){o.create(t.report).then(function(){r.go("app.reports",!1,!0).then(function(){a.showToast("Report Created Successfully!")})})},t.createReportWithLocation=function(){e.$broadcast("loading:show"),n.getCurrentPosition({timeout:1e4,enableHighAccuracy:!0}).then(function(e){t.report.location.latitude=e.coords.latitude,t.report.location.longitude=e.coords.longitude,t.createReport()},function(){e.$broadcast("loading:hide"),a.showToast("Could not get location.")})},t.submitReport=function(){t.report.user_id=e.user.id,t.report.category_id=t.report.category.id,t.useCurrentLocation?t.createReportWithLocation():t.createReport()}}]),ngModule("yatayat.controllers").controller("UserCtrl",["$scope","$rootScope","User","Router","UiHelper",function(t,e,o,r,n){t.updateProfile=function(){o.update(e.user).then(function(t){e.user=t,r.go("app.reports",!1,!0).then(function(){n.showToast("Profile Updated Successfully!")})},function(){n.showToast("Error Updating Profile!")})}}]),ngModule("yatayat.factories").factory("BaseModel",[function(){return{build:function(t){var e=Object.create(this);return angular.extend(e,t),e}}}]),ngModule("yatayat.factories").factory("Loading",["$ionicLoading",function(t){return{show:function(){t.show({template:"<i class='icon ion-loading-a'></i>"})},hide:function(){t.hide()},showWithOptions:function(e){t.show(e)}}}]).factory("UiHelper",["$cordovaToast","Loading",function(t,e){return{showToast:function(o,r,n){r=r||3e3,n=n||"bottom",window.cordova?(r=r>1e3?"long":"short",t.show(message,r,n)):e.showWithOptions({template:o,noBackdrop:!0,duration:r})}}}]).factory("Settings",["LocalStorage",function(t){return{all:function(){return{user_location:this.userLocation(),pushNotification:this.pushNotification()}},setMultiple:function(t){for(key in t)t.hasOwnProperty(key)&&this.setOne(key,t[key])},setOne:function(e,o){t.set(e,o)},userLocation:function(){return t.get("user_location")||"nep"},pushNotification:function(){return t.get("push_notification")||"eng"}}}]).factory("LocalStorage",["$window",function(t){return{set:function(e,o){t.localStorage[e]=o},get:function(e,o){return t.localStorage[e]||o},setObject:function(e,o){t.localStorage[e]=JSON.stringify(o)},getObject:function(e){return JSON.parse(t.localStorage[e]||"{}")}}}]).factory("Router",["$q","$state","$ionicHistory",function(t,e,o){return{go:function(r,n,i){var a=t.defer();return e.go(r,{},{reload:!!i}).then(function(){n&&o.clearHistory(),a.resolve()}),a.promise}}}]).factory("Modal",["$ionicModal","$q",function(t,e){return{setup:function(o,r){var n=e.defer();return t.fromTemplateUrl(r,{scope:o}).then(function(t){o.modal=t,n.resolve()}),o.closeModal=function(){o.modal.hide()},o.showModal=function(){o.modal.show()},n.promise}}}]).factory("Validator",[function(){return{isValidPhone:function(t){var e=/^\d{10}$/;return t.match(e)}}}]).factory("ActionSheet",["$ionicActionSheet",function(t){return{show:function(){t.show({buttons:[{text:"<b>Share</b> This"},{text:"Move"}],titleText:msg,cancelText:"Back",cancel:function(){},buttonClicked:function(){return!0}})}}}]),ngModule("yatayat.factories").factory("Raven",["$http","$q",function(t,e){var o="http://localhost:3000/";return{get:function(r){var n=e.defer();return t({url:o+r,method:"GET"}).then(function(t){n.resolve(t.data)},function(){n.reject()}),n.promise},post:function(r,n){var i=e.defer();return t({url:o+r,method:"POST",data:$.param(n)}).then(function(t){i.resolve(t.data)},function(){i.reject()}),i.promise}}}]),ngModule("yatayat.factories").factory("Report",["BaseModel","Raven","$q",function(t,e,o){return angular.extend(t,{all:function(){var r=o.defer(),n=[];return e.get("reports").then(function(e){angular.forEach(e,function(e){n.push(t.build(e))}),r.resolve(n)},function(){r.reject()}),r.promise},get:function(r){var n=o.defer();return e.get("reports/"+r).then(function(e){n.resolve(t.build(e))},function(){n.reject()}),n.promise},create:function(t){var r=o.defer();return e.post("reports",{report:t}).then(function(t){t.id?r.resolve(t):r.reject()},function(){r.reject()}),r.promise},like:function(t,r){var n=o.defer();return e.post("reports/like/",{id:t.id,sim_serial_number:r.sim_serial_number}).then(function(t){n.resolve(t)}),n.promise},dislike:function(t,r){var n=o.defer();return e.post("reports/dislike/",{id:t.id,sim_serial_number:r.sim_serial_number}).then(function(t){n.resolve(t)}),n.promise},length:function(){return this.body.length}})}]),ngModule("yatayat.factories").factory("Sim",["$q",function(t){return{getDetails:function(){var e=t.defer();if("undefined"!=typeof cordova){var o=cordova.require("cordova/plugin/telephonenumber");o.get(function(t){e.resolve(t)})}else e.resolve({simSerialNumber:"prativa",line1Number:"9808640123"});return e.promise}}}]),ngModule("yatayat.factories").factory("User",["Raven","$q","Sim",function(t,e,o){return{checkRegistration:function(){var r=e.defer();return o.getDetails().then(function(e){t.get("users/"+e.simSerialNumber).then(function(t){t&&t.id?r.resolve(t):r.reject()},function(){r.reject()})}),r.promise},register:function(o,r){var n=e.defer(),i={};return i.sim_serial_number=o,r&&(i.phone_number=r),t.post("users",{user:i}).then(function(t){t.id?n.resolve(t):n.reject()},function(){n.reject()}),n.promise},update:function(o){var r=e.defer();return delete o.id,t.post("users/"+o.sim_serial_number,{user:o}).then(function(t){r.resolve(t)},function(){r.reject()}),r.promise}}}]);